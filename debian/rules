#!/usr/bin/make -f
# Made with the aid of debmake, by Christoph Lameter,
# based on the sample debian/rules file for GNU hello by Ian Jackson.

package=cutils

build: build-stamp
build-stamp:
	dh_testdir
	./configure --prefix=/usr
	make
	touch build-stamp

clean:
	dh_testdir
	-rm -f build-stamp
	-make distclean
	-rm -f `find . -name "*~"`
	-rm -rf debian/tmp debian/files* core debian/substvars

binary-indep:	build
	$(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

binary-arch:	build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	# broken Makefiles for cutils don't use the prefix for etcdir,
	# and etcdir takes on different values in different Makefiles
	# so we force it to one thing then move the few files around
	# afterwards
	make install prefix=`pwd`/debian/tmp/usr etcdir=`pwd`/debian/tmp/usr/share/cutils
	mv debian/tmp/usr/share/cutils/*.db debian/tmp/usr/share/cutils/cinfo

	# now remove cweb, ctangle & cweave because they overlap
	# with package cweb. What a mess!
	cd debian/tmp/usr/man/man1 && rm cweave* ctangle*
	rm debian/tmp/usr/man/man5/cweb*
	cd debian/tmp/usr/bin && rm cweave ctangle
	rm -rf debian/tmp/usr/share/doc/cutils/examples/cweb
	rm debian/tmp/usr/share/cutils/cweb.mac

	mv debian/tmp/usr/man debian/tmp/usr/info debian/tmp/usr/share

	dh_installdocs NEWS README
	dh_undocumented
	dh_installchangelogs 
	dh_strip
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb


binary:		binary-indep binary-arch
.PHONY: binary binary-arch binary-indep clean checkroot
